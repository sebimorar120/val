<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Vrei sƒÉ fii Valentine-ul meu?</title>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,650;9..144,800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#ffd6e7;
      --bg2:#fff1f7;
      --card: rgba(255,255,255,.78);
      --stroke: rgba(255,255,255,.60);
      --text:#2b1b24;
      --muted:#6d4358;
      --yes:#ff3b7a;
      --shadow: 0 18px 60px rgba(43, 27, 36, .22);
      --radius: 26px;
      --panel: rgba(255,255,255,.58);
      --panel2: rgba(255,255,255,.28);
      --good: rgba(255,59,122,.18);
    }
    :root.night{
      --bg1:#1a1020;
      --bg2:#100a16;
      --card: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --panel: rgba(255,255,255,.10);
      --panel2: rgba(255,255,255,.06);
      --good: rgba(255,59,122,.24);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      min-height:100svh;
      display:block;
      padding: 18px;
      padding-top: calc(18px + env(safe-area-inset-top));
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
      overflow-x:hidden;
      overflow-y:auto;
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 520px at 20% 20%, rgba(255, 59, 122, .20), transparent 55%),
        radial-gradient(900px 540px at 80% 20%, rgba(255, 177, 206, .28), transparent 60%),
        radial-gradient(circle at top, var(--bg2), var(--bg1));
    }

    .wrap{ width:100%; max-width: 920px; margin: 0 auto; padding: 10px 0 30px; }

    /* Confetti */
    #confettiCanvas{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      pointer-events:none;
      z-index:9999;
    }

    /* Floating hearts (VISUAL ONLY, does not steal clicks) */
    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
      opacity:.45;
    }
    .heartFloat{
      position:absolute;
      bottom:-40px;
      font-size: 22px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.18));
      animation: rise var(--dur,10s) linear infinite;
      transform: translateX(var(--x,0px));
    }
    @keyframes rise{
      from{ transform: translate(var(--x,0px), 0) scale(var(--s,1)); opacity:0; }
      10%{ opacity: .9; }
      to{ transform: translate(var(--x,0px), -120vh) scale(var(--s,1)); opacity:0; }
    }

    .card{
      width: 100%;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      padding: 18px 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
      z-index: 2;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      position:relative;
      z-index:2;
      margin-bottom: 8px;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 10px;
      border-radius:999px;
      background: var(--panel);
      border: 1px solid var(--stroke);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      user-select:none;
      white-space: nowrap;
    }
    .controls{ display:flex; gap:8px; flex-wrap:wrap; }
    .iconBtn{
      border: 1px solid var(--stroke);
      background: var(--panel);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 900;
      cursor: pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .art{
      width: min(280px, 76vw);
      margin: 10px auto 6px;
      display:block;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
      position: relative;
      z-index: 2;
    }

    h1{
      font-family: Fraunces, serif;
      font-size: clamp(28px, 4.0vw, 52px);
      letter-spacing: -0.02em;
      line-height: 1.05;
      margin: 10px 0 6px;
      position: relative;
      z-index: 2;
    }
    .sub{
      margin: 0 0 12px;
      color: var(--muted);
      font-weight: 800;
      position: relative;
      z-index: 2;
    }

    .stats{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:center;
      margin: 10px 0 12px;
      position: relative;
      z-index: 2;
    }
    .stat{
      min-width: 190px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: var(--panel2);
      padding: 10px 12px;
      text-align:left;
    }
    .stat b{ display:block; font-size: 14px; }
    .stat span{ display:block; margin-top: 2px; color: var(--muted); font-weight: 800; font-size: 12px; }

    .button-zone{
      position: relative;
      width: min(560px, 96%);
      height: 170px;
      margin: 0 auto;
      touch-action: none;
      border-radius: 18px;
      z-index: 2;
    }
    .button-zone button{
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 16px 24px;
      font-size: 18px;
      font-weight: 900;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    #yesBtn{
      left: 16%;
      background: linear-gradient(135deg, var(--yes), #ff76a8);
      color:#fff;
    }
    #noBtn{
      left: 62%;
      background: rgba(255,255,255,.70);
      border: 1px solid var(--stroke);
      color: var(--text);
    }
    :root.night #noBtn{ background: rgba(255,255,255,.10); }

    .hint{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 800;
      font-size: 13px;
      position: relative;
      z-index: 2;
    }

    .dialog{
      margin: 12px auto 0;
      width: min(680px, 96%);
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: var(--panel2);
      padding: 12px 14px;
      text-align:left;
      position: relative;
      z-index: 2;
    }
    .dialog b{ display:block; font-size: 13px; margin-bottom: 4px; }
    .dialog p{ margin:0; color: var(--muted); font-weight: 800; }

    .result{
      display:none;
      margin-top: 16px;
      position: relative;
      z-index: 2;
    }
    .result h2{
      font-family: Fraunces, serif;
      font-size: clamp(32px, 4.5vw, 56px);
      margin: 10px 0 6px;
    }
    .result .mini{
      margin: 0 0 12px;
      color: var(--muted);
      font-weight: 900;
    }

    /* PLIC: button ALWAYS visible (outside the hidden note) */
    .envelope{
      width: min(760px, 98%);
      margin: 10px auto 0;
      border-radius: 22px;
      border: 1px solid var(--stroke);
      background: var(--panel2);
      overflow:hidden;
      box-shadow: var(--shadow);
      text-align:left;
      perspective: 900px;
    }
    .flap{
      height: 64px;
      background: linear-gradient(135deg, rgba(255,59,122,.26), rgba(255,122,176,.10));
      border-bottom: 1px solid var(--stroke);
      transform-origin: top;
      transform: rotateX(0deg);
      backface-visibility: hidden;
      transition: transform .55s cubic-bezier(.2,.9,.2,1);
    }
    .envelopeBar{
      padding: 10px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      border-bottom: 1px solid var(--stroke);
      background: rgba(255,255,255,.08);
    }
    .envelopeBar b{ font-size: 13px; }
    .btnSmall{
      border: 1px solid var(--stroke);
      background: var(--panel);
      color: var(--text);
      font-weight: 900;
      border-radius: 999px;
      padding: 10px 12px;
      cursor:pointer;
    }

    .note{
      max-height: 0;
      opacity: 0;
      transform: translateY(-8px);
      transition: max-height .55s cubic-bezier(.2,.9,.2,1), opacity .35s ease, transform .35s ease;
      overflow: hidden;
      padding: 0 14px;
    }
    .envelope.open .flap{ transform: rotateX(160deg); }
    .envelope.open .note{
      max-height: 2000px;
      opacity: 1;
      transform: translateY(0);
      padding: 14px;
    }
    .note h3{ margin: 0 0 8px; font-family: Fraunces, serif; }
    .note p{ margin: 0 0 10px; color: var(--muted); font-weight: 800; }
    .sig{ font-weight: 900; margin-bottom: 12px; }

    .strip{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.14);
      padding: 12px;
    }
    :root.night .strip{ background: rgba(255,255,255,.05); }
    .stripHead{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap:wrap;
    }
    .stripHead b{ font-size: 13px; }
    .stripHead span{ font-size: 12px; color: var(--muted); font-weight: 900; }

    .photos{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
    }
    @media (max-width: 760px){
      .photos{ grid-template-columns: repeat(3, 1fr); }
      .button-zone{ height: 190px; }
      #yesBtn{ left: 10%; }
      #noBtn{ left: 56%; }
    }
    .photos img{
      width:100%;
      aspect-ratio: 1/1;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      object-fit: cover;
      background: rgba(255,255,255,.10);
    }

    .options{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    @media (max-width: 760px){ .options{ grid-template-columns: 1fr; } }
    .opt{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.14);
      padding: 12px;
      cursor:pointer;
      user-select:none;
    }
    :root.night .opt{ background: rgba(255,255,255,.05); }
    .opt.selected{
      outline: 4px solid var(--good);
      border-color: rgba(255,59,122,.45);
    }
    .opt b{ display:block; }
    .opt span{ display:block; margin-top: 3px; color: var(--muted); font-weight: 800; font-size: 12px; }

    .actions{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .btn{
      border: 1px solid rgba(255,255,255,.16);
      background: linear-gradient(135deg, var(--yes), #ff76a8);
      color:#fff;
      font-weight: 900;
      border-radius: 999px;
      padding: 12px 16px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
    }
    .btn.ghost{
      background: var(--panel);
      color: var(--text);
      border: 1px solid var(--stroke);
      box-shadow:none;
    }

    .heartGameBox{
      margin-top: 10px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.12);
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    :root.night .heartGameBox{ background: rgba(255,255,255,.05); }
    .heartTray{ display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }
    .hbtn{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid var(--stroke);
      background: rgba(255,59,122,.12);
      cursor:pointer;
      display:grid; place-items:center;
      font-weight: 900;
      user-select:none;
    }
    .hbtn.used{ opacity: .45; pointer-events:none; }

    .footerRow{
      margin-top: 12px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content:center;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }

    /* Games */
    .minigames{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      text-align:left;
      width: min(760px, 98%);
      margin-left:auto;
      margin-right:auto;
    }
    @media (max-width: 760px){ .minigames{ grid-template-columns: 1fr; } }

    .panelBox{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: var(--panel2);
      padding: 12px;
    }
    .panelBox h4{ margin: 0 0 8px; font-family: Fraunces, serif; }
    .panelBox p{ margin: 0; color: var(--muted); font-weight: 800; }

    .wheelRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-top: 10px;
    }
    .wheel{
      width: 74px; height: 74px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: conic-gradient(from 0deg, rgba(255,59,122,.9), rgba(255,122,176,.9), rgba(255,220,235,.9), rgba(255,59,122,.9));
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
      display:grid;
      place-items:center;
      font-weight: 900;
      color: white;
      user-select:none;
      cursor: pointer;
    }
    .wheel.spin{ animation: spin 1.2s cubic-bezier(.15,.9,.2,1) forwards; }
    @keyframes spin{ from{ transform: rotate(0deg); } to{ transform: rotate(1260deg); } }

    .grid4{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 10px;
    }
    .tile{
      aspect-ratio: 1/1;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.12);
      display:grid;
      place-items:center;
      font-size: 20px;
      cursor:pointer;
      user-select:none;
      font-weight: 900;
      color: var(--text);
    }
    :root.night .tile{ background: rgba(255,255,255,.05); }
    .tile.revealed{ background: rgba(255,59,122,.16); border-color: rgba(255,59,122,.35); }
    .tile.matched{ opacity: .55; pointer-events:none; }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="hearts" id="hearts"></div>

  <div class="wrap">
    <main class="card" id="card">
      <div class="topbar">
        <div class="badge"><span>üíò</span><span>Protocol Valentine: ACTIV</span></div>
        <div class="controls">
          <button class="iconBtn" id="themeBtn" type="button">üåô</button>
          <button class="iconBtn" id="resetBtn" type="button">‚Ü∫</button>
        </div>
      </div>

      <svg class="art" viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg" aria-label="AnimƒÉlu»õ drƒÉgu»õ cu inimioarƒÉ" role="img">
        <defs>
          <linearGradient id="fur" x1="0" x2="1">
            <stop offset="0" stop-color="#f7c7a1"/>
            <stop offset="1" stop-color="#f2a97b"/>
          </linearGradient>
          <linearGradient id="heart" x1="0" x2="1">
            <stop offset="0" stop-color="#ff4d7d"/>
            <stop offset="1" stop-color="#ff1f68"/>
          </linearGradient>
        </defs>
        <path d="M250 50 C250 33 270 25 282 38 C294 25 314 33 314 50
                 C314 78 282 92 282 106 C282 92 250 78 250 50Z" fill="url(#heart)"/>
        <path d="M90 120 C90 70 140 40 190 60 C240 40 290 70 290 120
                 C290 180 240 210 190 210 C140 210 90 180 90 120Z" fill="url(#fur)"/>
        <path d="M110 92 L95 55 L140 78 Z" fill="#f2a97b"/>
        <path d="M270 92 L285 55 L240 78 Z" fill="#f2a97b"/>
        <circle cx="160" cy="130" r="8"/>
        <circle cx="220" cy="130" r="8"/>
        <path d="M190 144 C186 144 182 148 182 152 C182 160 190 164 190 170
                 C190 164 198 160 198 152 C198 148 194 144 190 144Z" fill="#ff7aa2"/>
      </svg>

      <h1 id="title">Doroteea, vrei sƒÉ fii Valentine-ul meu?</h1>
      <p class="sub" id="subtitle">DouƒÉ butoane. Un destin. (mucho grande ‚Ä¢ pisicuto ‚Ä¢ bursuc)</p>

      <div class="stats" aria-live="polite">
        <div class="stat">
          <b><span id="noAttempts">0</span> √ÆncercƒÉri de ‚ÄûNU‚Äù</b>
          <span>(drƒÉgu»õ, dar nu)</span>
        </div>
        <div class="stat">
          <b>Dimensiunea lui ‚ÄûDA‚Äù: <span id="yesLevel">1.0</span>x</b>
          <span>&nbsp;</span>
        </div>
        <div class="stat">
          <b>Inevitabilitate: <span id="inev">0</span>%</b>
          <span>&nbsp;</span>
        </div>
      </div>

      <section class="button-zone" id="zone">
        <button id="yesBtn" type="button">DA</button>
        <button id="noBtn" type="button">NU</button>
      </section>

      <div class="hint" id="hint">‚ÄûNU‚Äù e cam timid üòà</div>

      <div class="dialog" role="status" aria-live="polite">
        <b>Comentariu live</b>
        <p id="dialogText">Doar unul dintre butoane chiar vrea sƒÉ fie apƒÉsat.</p>
      </div>

      <section class="result" id="result">
        <h2>YAAAY! üéâ</h2>
        <p class="mini">Tocmai l-ai fƒÉcut pe <span id="fromNameMini">Sebastian</span> super fericit.</p>

        <div class="envelope" id="envelope">
          <div class="flap"></div>

          <!-- ALWAYS-visible bar with the toggle button -->
          <div class="envelopeBar">
            <b>Plic üíå</b>
            <button class="btnSmall" id="openBtn" type="button">Deschide plicul</button>
          </div>

          <div class="note" id="note">
            <h3>O noti»õƒÉ micƒÉ üíå</h3>
            <p>
              Am o propunere: alegi una de mai jos »ôi eu vin cu vibe-ul bun, gustƒÉrile »ôi playlist-ul.
              (»ôi cu energia: <b>mucho grande</b>, <b>pisicuto</b>, <b>bursuc</b> üòå)
            </p>
            <div class="sig">‚Äî <span id="fromName">Sebastian</span></div>

            <div class="strip">
              <div class="stripHead">
                <b>Momentele noastre ‚ú®</b>
                <span id="stripCaption">‚Äûmomentele noastre‚Äù + mucho grande ‚Ä¢ pisicuto ‚Ä¢ bursuc</span>
              </div>
              <div class="photos">
                <img src="images/1.png" alt="Amintire 1">
                <img src="images/2.png" alt="Amintire 2">
                <img src="images/3.png" alt="Amintire 3">
                <img src="images/4.png" alt="Amintire 4">
                <img src="images/5.png" alt="Amintire 5">
                <img src="images/6.png" alt="Amintire 6">
              </div>
            </div>

            <div class="options" id="options">
              <div class="opt" data-opt="Cafea + plimbare"><b>‚òï Cafea + plimbare</b><span>14 feb ‚Ä¢ 16:00</span></div>
              <div class="opt" data-opt="CinƒÉ"><b>üçù CinƒÉ</b><span>14 feb ‚Ä¢ 19:30</span></div>
              <div class="opt" data-opt="Film + desert"><b>üçø Film + desert</b><span>14 feb ‚Ä¢ 18:30</span></div>
            </div>

            <div class="actions">
              <button class="btn" id="icsBtn" type="button">AdaugƒÉ √Æn Calendar</button>
              <button class="btn ghost" id="copyBtn" type="button">CopiazƒÉ link-ul</button>
            </div>

            <div class="heartGameBox">
              <div><b>Jocul inimioarelor:</b> <span id="heartGame">0/5</span> ‚Ä¢ <b>Secret:</b> <span id="secretStatus">blocat üîí</span></div>
              <div class="heartTray" id="heartTray">
                <div class="hbtn">üíó</div><div class="hbtn">üíó</div><div class="hbtn">üíó</div><div class="hbtn">üíó</div><div class="hbtn">üíó</div>
              </div>
            </div>

            <div class="footerRow"><span id="countdown">NumƒÉrƒÉtoare inversƒÉ: ‚Ä¶</span></div>
          </div>
        </div>

        <div class="minigames">
          <div class="panelBox">
            <h4>Roata surprizei üé°</h4>
            <p>√énv√¢rte pentru un bonus drƒÉgu»õ.</p>
            <div class="wheelRow">
              <div class="wheel" id="wheel">SPIN</div>
              <button class="btn ghost" id="spinBtn" type="button">√énv√¢rte</button>
            </div>
            <p style="margin-top:10px"><b>Rezultat:</b> <span id="spinText" style="color:var(--muted); font-weight:900">‚Äî</span></p>
          </div>

          <div class="panelBox">
            <h4>Mini ‚Äûmemory‚Äù üß†</h4>
            <p>GƒÉse»ôte perechile ca sƒÉ deblochezi o replicƒÉ extra.</p>
            <div class="grid4" id="memoryGrid"></div>
            <p style="margin-top:10px"><b>Status:</b> <span id="memoryText" style="color:var(--muted); font-weight:900">GƒÉse»ôte toate perechile.</span></p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      // --- MuzicƒÉ: autoplay muted, apoi porne»ôte cu sunet la primul click/tap (browser rule) ---
      const bgMusic = document.getElementById("bgMusic");
      const musicToast = document.getElementById("musicToast");

      async function tryAutoplayMuted(){
        if(!bgMusic) return;
        try{
          bgMusic.muted = true;
          await bgMusic.play();
          if(musicToast) musicToast.style.display = "block";
        }catch(e){
          // file missing or autoplay blocked; user gesture will handle it
          if(musicToast) musicToast.style.display = "block";
        }
      }

      async function unmuteAndPlay(){
        if(!bgMusic) return;
        try{
          bgMusic.muted = false;
          await bgMusic.play();
        }catch(e){}
        if(musicToast) musicToast.style.display = "none";
      }

      tryAutoplayMuted();

      const firstGesture = () => unmuteAndPlay();
      document.addEventListener("pointerdown", firstGesture, { once:true });
      document.addEventListener("keydown", firstGesture, { once:true });
      musicToast?.addEventListener("click", unmuteAndPlay);

      const params = new URLSearchParams(location.search);
      const toName = (params.get("to") || "Doroteea").trim();
      const fromName = (params.get("from") || "Sebastian").trim();
      const INSIDE = "mucho grande ‚Ä¢ pisicuto ‚Ä¢ bursuc";

      // Names
      const title = document.getElementById("title");
      const fromNameEl = document.getElementById("fromName");
      const fromNameMini = document.getElementById("fromNameMini");
      const stripCaption = document.getElementById("stripCaption");
      if(title) title.textContent = `${toName}, vrei sƒÉ fii Valentine-ul meu?`;
      if(fromNameEl) fromNameEl.textContent = fromName;
      if(fromNameMini) fromNameMini.textContent = fromName;
      if(stripCaption) stripCaption.textContent = `‚Äûmomentele noastre‚Äù + ${INSIDE}`;

      // Floating hearts
      const hearts = document.getElementById("hearts");
      const emojis = ["üíó","üíñ","üíò","üíï"];
      for(let i=0;i<16;i++){
        const s = document.createElement("div");
        s.className = "heartFloat";
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        s.style.left = Math.floor(Math.random()*100) + "vw";
        s.style.setProperty("--dur", (8 + Math.random()*8) + "s");
        s.style.setProperty("--x", ((Math.random()*120)-60) + "px");
        s.style.setProperty("--s", (0.8 + Math.random()*0.9));
        s.style.animationDelay = (-Math.random()*12) + "s";
        hearts.appendChild(s);
      }

      // Theme
      const themeBtn = document.getElementById("themeBtn");
      const storedTheme = localStorage.getItem("val_theme");
      if (storedTheme === "night") document.documentElement.classList.add("night");
      if(themeBtn) themeBtn.textContent = document.documentElement.classList.contains("night") ? "‚òÄÔ∏è" : "üåô";
      themeBtn?.addEventListener("click", () => {
        document.documentElement.classList.toggle("night");
        const night = document.documentElement.classList.contains("night");
        localStorage.setItem("val_theme", night ? "night" : "day");
        themeBtn.textContent = night ? "‚òÄÔ∏è" : "üåô";
      });

      // Reset
      document.getElementById("resetBtn")?.addEventListener("click", () => {
        const u = new URL(location.href);
        u.searchParams.delete("accepted");
        history.replaceState({}, "", u.toString());
        location.reload();
      });

      // Confetti
      const confettiCanvas = document.getElementById("confettiCanvas");
      function resizeConfetti(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        confettiCanvas.width = Math.floor(window.innerWidth * dpr);
        confettiCanvas.height = Math.floor(window.innerHeight * dpr);
        confettiCanvas.style.width = "100vw";
        confettiCanvas.style.height = "100vh";
      }
      resizeConfetti();
      window.addEventListener("resize", resizeConfetti);
      const conf = confetti.create(confettiCanvas, { resize:false, useWorker:true });
      function blast(){
        const end = Date.now() + 1200;
        (function frame(){
          conf({ particleCount: 10, spread: 90, startVelocity: 42, ticks: 160, origin: { x: Math.random(), y: Math.random()*0.25 }});
          if (Date.now() < end) requestAnimationFrame(frame);
        })();
        setTimeout(()=>conf({ particleCount: 220, spread: 140, startVelocity: 55, ticks: 200, origin:{x:.5,y:.55}}), 220);
      }

      // Yes/No logic
      const zone = document.getElementById("zone");
      const yesBtn = document.getElementById("yesBtn");
      const noBtn  = document.getElementById("noBtn");
      const result = document.getElementById("result");
      const hint = document.getElementById("hint");
      const dialogText = document.getElementById("dialogText");
      const noAttemptsEl = document.getElementById("noAttempts");
      const yesLevelEl = document.getElementById("yesLevel");
      const inevEl = document.getElementById("inev");

      let noAttempts = 0;
      let yesScale = 1.0;
      const noLines = [
        "‚ÄûNU‚Äù? Curajos üòå",
        "E»ôti sigurƒÉ? üëÄ",
        "Bursuc detected.",
        "Ok‚Ä¶ butonul ‚ÄûNU‚Äù devine timid.",
        "mucho grande‚Ä¶ √ÆncƒÉ √Æncerci üòÇ",
        "√é»õi aduc gustƒÉri. Serios.",
        "pisicuto mode: fuge üòà",
        "Universul voteazƒÉ ‚ÄûDA‚Äù.",
        "Ultima »ôansƒÉ de dramƒÉ.",
        "Gata. Destin. ‚úÖ"
      ];
      function updateInev(){
        const p = Math.min(99, Math.floor(100 * (1 - Math.exp(-noAttempts / 4))));
        inevEl.textContent = String(p);
      }
      function growYes(){
        yesScale = Math.min(2.4, yesScale + 0.12);
        yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
        yesLevelEl.textContent = yesScale.toFixed(1);
      }
      function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
      function moveNo(px, py){
        const z = zone.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();
        let dx = (b.left + b.width/2) - px;
        let dy = (b.top  + b.height/2) - py;
        let mag = Math.hypot(dx,dy) || 1;
        dx/=mag; dy/=mag;
        const push = 120 + Math.min(160, noAttempts*10);
        let newLeft = (b.left - z.left) + dx * push;
        let newTop  = (b.top  - z.top ) + dy * push;
        newLeft = clamp(newLeft, 0, z.width - b.width);
        newTop  = clamp(newTop,  0, z.height - b.height);
        noBtn.style.left = newLeft + "px";
        noBtn.style.top  = newTop  + "px";
        noBtn.style.transform = "none";
        growYes();
      }
      function pokeNo(e){
        noAttempts++;
        noAttemptsEl.textContent = String(noAttempts);
        dialogText.textContent = noLines[Math.min(noLines.length-1, noAttempts-1)];
        updateInev();
        moveNo(e.clientX, e.clientY);
        if(noAttempts >= 9){
          noBtn.style.display = "none";
          hint.textContent = "Ok‚Ä¶ deci ‚ÄûDA‚Äù? üòá";
          dialogText.textContent = "‚ÄûNU‚Äù a ie»ôit din chat. ‚úÖ";
        }
      }
      zone.addEventListener("pointermove", (e)=>{
        if (noBtn.style.display === "none") return;
        const b = noBtn.getBoundingClientRect();
        const d = Math.hypot((b.left+b.width/2)-e.clientX, (b.top+b.height/2)-e.clientY);
        if (d < 150) pokeNo(e);
      });
      noBtn.addEventListener("click", (e)=>{ e.preventDefault(); pokeNo(e); });

      // Envelope toggle (WORKS because button is outside note)
      const envelope = document.getElementById("envelope");
      const openBtn = document.getElementById("openBtn");
      function setEnvelope(open){
        envelope.classList.toggle("open", open);
        openBtn.textContent = open ? "√énchide plicul" : "Deschide plicul";
      }
      openBtn.addEventListener("click", () => setEnvelope(!envelope.classList.contains("open")));
      setEnvelope(false); // start closed always

      // Accept flow
      function accept(){
        zone.style.display = "none";
        hint.style.display = "none";
        result.style.display = "block";
        resizeConfetti();
        blast();
        setEnvelope(false);
        const u = new URL(location.href);
        u.searchParams.set("accepted","1");
        history.replaceState({}, "", u.toString());
        updateCountdown();
      }
      yesBtn.addEventListener("click", accept);

      if(params.get("accepted")==="1"){
        zone.style.display="none";
        hint.style.display="none";
        result.style.display="block";
        setEnvelope(false);
      }

      // Copy link
      document.getElementById("copyBtn")?.addEventListener("click", async ()=>{
        const u = new URL(location.href);
        u.searchParams.set("to", toName);
        u.searchParams.set("from", fromName);
        u.searchParams.set("accepted","1");
        try{ await navigator.clipboard.writeText(u.toString()); }
        catch{ prompt("CopiazƒÉ link-ul:", u.toString()); }
      });

      // Calendar (simple ICS for selected option)
      const options = document.getElementById("options");
      let selectedOpt = "Cafea + plimbare";
      function selectOpt(el){
        options.querySelectorAll(".opt").forEach(o=>o.classList.remove("selected"));
        el.classList.add("selected");
        selectedOpt = el.dataset.opt || selectedOpt;
      }
      selectOpt(options.querySelector(".opt"));
      options.addEventListener("click", (e)=>{
        const opt = e.target.closest(".opt");
        if(opt) selectOpt(opt);
      });

      function nextFeb14Year(){
        const now = new Date();
        const y = now.getFullYear();
        const feb14 = new Date(y,1,14,0,0,0,0);
        return (now <= feb14) ? y : y+1;
      }
      const YEAR = nextFeb14Year();
      function toUTCICS(d){
        const yyyy=d.getUTCFullYear();
        const mm=String(d.getUTCMonth()+1).padStart(2,"0");
        const dd=String(d.getUTCDate()).padStart(2,"0");
        const hh=String(d.getUTCHours()).padStart(2,"0");
        const mi=String(d.getUTCMinutes()).padStart(2,"0");
        return `${yyyy}${mm}${dd}T${hh}${mi}00Z`;
      }
      function timeForOpt(){
        if(selectedOpt.includes("CinƒÉ")) return "19:30";
        if(selectedOpt.includes("Film")) return "18:30";
        return "16:00";
      }
      function localDateFor(time){
        const [hh,mm]=time.split(":").map(Number);
        return new Date(YEAR,1,14,hh,mm,0,0);
      }

      document.getElementById("icsBtn")?.addEventListener("click", ()=>{
        const time = timeForOpt();
        const start = localDateFor(time);
        const end = new Date(start.getTime()+90*60*1000);
        const uid = `val-${Date.now()}@ghpages`;
        const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Valentine//RO
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${toUTCICS(new Date())}
DTSTART:${toUTCICS(start)}
DTEND:${toUTCICS(end)}
SUMMARY:√ént√¢lnire Valentine: ${selectedOpt}
DESCRIPTION:Ai spus DA üíò\\nPentru: ${toName}\\nDe la: ${fromName}\\nInside: ${INSIDE}
END:VEVENT
END:VCALENDAR`;
        const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href=url;
        a.download="valentine.ics";
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      // Countdown
      const countdownEl = document.getElementById("countdown");
      function fmt(ms){
        const s=Math.max(0,Math.floor(ms/1000));
        const d=Math.floor(s/86400);
        const h=Math.floor((s%86400)/3600);
        const m=Math.floor((s%3600)/60);
        return `${d}z ${h}h ${m}m`;
      }
      function updateCountdown(){
        const t = localDateFor(timeForOpt());
        const ms = t - new Date();
        countdownEl.textContent = ms>0 ? `NumƒÉrƒÉtoare inversƒÉ: ${fmt(ms)}` : `NumƒÉrƒÉtoare inversƒÉ: e momentul üíò`;
      }
      updateCountdown();
      setInterval(updateCountdown, 15000);

      // Heart game (5 clicks)
      const heartGame = document.getElementById("heartGame");
      const secretStatus = document.getElementById("secretStatus");
      let taps = 0;
      document.querySelectorAll("#heartTray .hbtn").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          if(btn.classList.contains("used")) return;
          btn.classList.add("used");
          taps++;
          heartGame.textContent = `${taps}/5`;
          if(taps>=5) secretStatus.textContent = `deblocat üîì (${INSIDE})`;
          conf({ particleCount: 18, spread: 60, startVelocity: 22, ticks: 130, origin:{x:.5,y:.75} });
        });
      });

      // Wheel game (always works)
      const wheel = document.getElementById("wheel");
      const spinBtn = document.getElementById("spinBtn");
      const spinText = document.getElementById("spinText");
      const outcomes = [
        "Bonus: tu alegi playlist-ul üé∂",
        "Bonus: desert obligatoriu üç∞",
        "Bonus: 3 √ÆmbrƒÉ»õi»ôƒÉri minim ü§ó",
        "Bonus: eu aduc flori üå∏",
        "Bonus: pupic pe frunte üíã",
        "Bonus: »õinute asortate (poate) üòå"
      ];
      let spinning=false;
      function spin(){
        if(spinning) return;
        spinning=true;
        wheel.classList.add("spin");
        const idx=Math.floor(Math.random()*outcomes.length);
        setTimeout(()=>{
          wheel.classList.remove("spin");
          spinText.textContent = outcomes[idx];
          spinning=false;
        }, 1200);
      }
      spinBtn.addEventListener("click", spin);
      wheel.addEventListener("click", spin);

      // Memory game (always works)
      const memoryGrid = document.getElementById("memoryGrid");
      const memoryText = document.getElementById("memoryText");
      const icons = ["üíò","üíò","üçì","üçì","üåô","üåô","üéÄ","üéÄ"];
      function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
      const deck = shuffle([...icons]);
      let first=null, lock=false, matched=0;

      function render(){
        memoryGrid.innerHTML="";
        deck.forEach((ic, idx)=>{
          const t=document.createElement("div");
          t.className="tile";
          t.textContent="‚Ä¢";
          t.dataset.idx=String(idx);
          t.addEventListener("click", ()=>flip(t));
          memoryGrid.appendChild(t);
        });
      }
      function flip(el){
        if(lock || el.classList.contains("matched") || el.classList.contains("revealed")) return;
        const idx=Number(el.dataset.idx);
        el.classList.add("revealed");
        el.textContent=deck[idx];
        if(!first){ first=el; return; }
        if(first===el) return;

        const i1=Number(first.dataset.idx), i2=idx;
        if(deck[i1]===deck[i2]){
          el.classList.add("matched");
          first.classList.add("matched");
          matched+=2;
          first=null;
          memoryText.textContent = matched===deck.length ? "Deblocat: noi doi = match perfect üíû" : `Perechi: ${matched/2}/4.`;
        }else{
          lock=true;
          setTimeout(()=>{
            el.classList.remove("revealed"); first.classList.remove("revealed");
            el.textContent="‚Ä¢"; first.textContent="‚Ä¢";
            first=null; lock=false;
          }, 650);
        }
      }
      render();
    });
  </script>

  <!-- MuzicƒÉ fundal (ai nevoie de assets/west-coast.mp3) -->
  <audio id="bgMusic" preload="auto" loop playsinline>
    <source src="assets/west-coast.mp3" type="audio/mpeg">
  </audio>

  <div id="musicToast" style="
    position:fixed; left:50%; transform:translateX(-50%);
    bottom:16px; z-index:9998;
    background:rgba(255,255,255,.72); border:1px solid rgba(255,255,255,.60);
    padding:10px 12px; border-radius:999px;
    box-shadow:0 12px 30px rgba(0,0,0,.18);
    font-weight:900; display:none; cursor:pointer; user-select:none;
    backdrop-filter: blur(10px);
  ">üîä ApasƒÉ oriunde ca sƒÉ porneascƒÉ muzica</div>

</body>
</html>
